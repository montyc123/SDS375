<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Getting to know your data 2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Claus O. Wilke" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="Wilke-slides-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

.title[
# Getting to know your data 2
]
.author[
### Claus O. Wilke
]
.date[
### last updated: 2024-02-19
]

---




## Recall from previous lecture: Data dictionary

**Data Dictionary**&lt;br&gt;
A "centralized repository of information about data such as meaning, relationships to other data, origin, usage, and format" ([Wikipedia](https://en.wikipedia.org/wiki/Data_dictionary))

---

## Recall from previous lecture: Data dictionary

### Dataset: Births in NC

.pull-left.small-font.width-45.move-up-1em[
**Details and Source**&lt;br&gt;
This dataset contains data on a sample of 1450 birth records from 2001 that statistician John Holcomb at Cleveland State University selected from the North Carolina State Center for Health and Environmental Statistics.

The dataset has 1450 observations on 15 variables.
]


.pull-right.xtiny-font.move-up-4em.width-50[
Variable       | Description
----------:    | :-----------
`ID`           | Patient ID code
`Plural`       | `1`=single birth, `2`=twins, `3`=triplets
`Sex`          | Sex of the baby: `1`=male `2`=female
`MomAge`	     | Mother's age (in years)
`Weeks`        | Completed weeks of gestation
`Marital`      | Marital status: `1`=married or `2`=not married
`RaceMom`	     | Mother's race: `1`=white, `2`=black, `3`=American Indian, `4`=Chinese, `5`=Japanese, `6`=Hawaiian, `7`=Filipino, or `8`=Other Asian or Pacific Islander
`HispMom`	     | Hispanic origin of mother: `C`=Cuban, `M`=Mexican, `N`=not Hispanic, `O`=Other Hispanic, `P`=Puerto Rico, `S`=Central/South America
`Gained`       | Weight gained during pregnancy (in pounds)
`Smoke`        | Smoker mom? `1`=yes or `0`=no
`BirthWeightOz` |	Birth weight in ounces
`BirthWeightGm` | Birth weight in grams
`Low`           |	Indicator for low birth weight: `1`=2500 grams or less
`Premie`       |	Indicator for premature birth: `1`=36 weeks or sooner
`MomRace`      |	Mother's race: `black`, `hispanic`, `other`, or `white`
]

---

## A complete record of data provenance requires more information

--

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

1. Motivation

--

2. Composition

--

3. Collection Process

--

4. Preprocessing/cleaning/labeling

--

5. Uses

--

6. Distribution

--

7. Maintenance

---

## Data provenance: Motivation

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- For what purpose was the dataset created?

--

- Who created the dataset?

--

- Who funded the creation of the dataset?

---

## Data provenance: Composition

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- What do the instances that comprise the dataset represent?

--

- How many instances are there in total?

--

- Does the dataset contain all possible instances or is it a sample
(not necessarily random) of instances from a larger set?

--

- Is any information missing from individual instances?

--

- ... 

See Gebru et al. for complete set of questions

---

## Data provenance: Collection Process

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- How was the data associated with each instance acquired?

--

- If the dataset is a sample from a larger set, what was the sampling
strategy?

--

- Were any ethical review processes conducted?

--

- If the dataset relates to people, did the individuals in question consent to the collection and use of their data?

--

- If consent was obtained, were the consenting individuals provided with a mechanism to revoke their consent in the future or
for certain uses?

--

- ... 

See Gebru et al. for complete set of questions

---

## Data provenance: Preprocessing/cleaning/labeling

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- Was any preprocessing/cleaning/labeling of the data done?

--

- Was the raw data saved in addition to the preprocessed/cleaned/labeled
data?

--

- Is the software used to preprocess/clean/label the instances available?

---

## Data provenance: Uses

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- Has the dataset been used for any tasks already?

--

- Is there a repository that links to any or all papers or systems that
use the dataset?

--

- What (other) tasks could the dataset be used for?

--

- Is there anything about the composition of the dataset or the way
it was collected and preprocessed/cleaned/labeled that might impact future uses?

--

- Are there tasks for which the dataset should not be used?

---

## Data provenance: Distribution

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- Will the dataset be distributed to third parties outside of the entity (e.g., company, institution, organization) on behalf of which
the dataset was created?

--

- How will the dataset will be distributed (e.g., tarball on website,
API, GitHub)? Does the dataset have a digital object identifier (DOI)?

--

- When will the dataset be distributed?

--

- Will the dataset be distributed under a copyright or other intellectual property (IP) license, and/or under applicable terms of use
(ToU)?

--

- Have any third parties imposed IP-based or other restrictions on
the data associated with the instances?

--

- Do any export controls or other regulatory restrictions apply to
the dataset or to individual instances?

---

## Data provenance: Maintenance

.absolute-bottom-right.tiny-font[
Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
]

--

- Who is supporting/hosting/maintaining the dataset?

--

- How can the owner/curator/manager of the dataset be contacted
(e.g., email address)?

--

- Will the dataset be updated (e.g., to correct labeling errors, add
new instances, delete instances)? If so, please describe how often, by
whom, and how updates will be communicated to users (e.g., mailing list,
GitHub)?

--

- If the dataset relates to people, are there applicable limits on the
retention of the data associated with the instances?

--

- Will older versions of the dataset continue to be supported/hosted/maintained?

--

- If others want to extend/augment/build on/contribute to the
dataset, is there a mechanism for them to do so?

---

## Provenance at a glance: Data Nutritional Labels

--

&lt;img src="know-your-data-2_files/datanutrition.png" width = 80%&gt;

.absolute-bottom-right.tiny-font[
The Data Nutrition Project&lt;br&gt;https://datanutrition.org/
]

[//]: # "segment ends here"

---
class: center middle

## Some real-world examples

---

## Some real-world examples

Let's review three datasets on Kaggle:

- [Pima Indians Diabetes Database](https://www.kaggle.com/uciml/pima-indians-diabetes-database)

- [Pokemon](https://www.kaggle.com/abcsds/pokemon)

- [Women's E-Commerce Clothing Reviews](https://www.kaggle.com/nicapotato/womens-ecommerce-clothing-reviews)

[//]: # "segment ends here"

---
class: center middle

## Working with missing values in R

---

## R propagates missingness


```r
x &lt;- c(1, 2, NA, 4)

sum(x)
```

```
[1] NA
```

--


```r
mean(x)
```

```
[1] NA
```

--


```r
x == 2
```

```
[1] FALSE  TRUE    NA FALSE
```


---

## Many functions allow explicit exclusion of `NA` values


```r
x &lt;- c(1, 2, NA, 4)

sum(x, na.rm = TRUE)
```

```
[1] 7
```

--


```r
mean(x, na.rm = TRUE)
```

```
[1] 2.333333
```

--

But is this the right thing to do?

---

## There is no general right or wrong approach


```r
x &lt;- c(2, 1, 1, 2, 1, 1, 1, 2, NA, 1, 2, 1, 1, 2, 1, 1, 1, 2)
mean(x, na.rm = TRUE)
```

```
[1] 1.352941
```

--


```r
x &lt;- c(NA, NA, NA, 2, NA, NA, NA, NA, NA, 1, NA, NA, NA, NA)
mean(x, na.rm = TRUE)
```

```
[1] 1.5
```

--

R's default is conservative: If there's at least one `NA`, the result is `NA`

---

## We need to use `is.na()` to check for missing values

.small-font[

```r
c(1, 2, NA, 4) == NA   # does not work
```

```
[1] NA NA NA NA
```

```r
is.na(c(1, 2, NA, 4))  # works
```

```
[1] FALSE FALSE  TRUE FALSE
```
]

---

## There are several missing values of different types

- `NA`: logical constant indicating missing value

- `NA_integer_`: missing integer

- `NA_real_`: missing real

- `NA_complex_`: missing complex value

- `NA_character_`: missing string


---

## Sometimes the type matters


```r
c(1, 2, NA)
```

```
[1]  1  2 NA
```

```r
c(1, 2, NA_real_)
```

```
[1]  1  2 NA
```

```r
c(1, 2, NA_character_)
```

```
[1] "1" "2" NA 
```

---

## Sometimes the type matters


```r
typeof(c(1, 2, NA))
```

```
[1] "double"
```

```r
typeof(c(1, 2, NA_real_))
```

```
[1] "double"
```

```r
typeof(c(1, 2, NA_character_))
```

```
[1] "character"
```

---

## Replacing `NA` values with something else

Remember from class on data wrangling:

.small-font[

```r
band_data &lt;- full_join(band_members, band_instruments)
band_data
```

```
# A tibble: 4 Ã— 3
  name  band    plays 
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
1 Mick  Stones  &lt;NA&gt;  
2 John  Beatles guitar
3 Paul  Beatles bass  
4 Keith &lt;NA&gt;    guitar
```
]

---

## Replacing `NA` values with something else

Replace `NA`s with empty strings in `plays` column:

.small-font[

```r
band_data %&gt;%
  mutate(plays = replace_na(plays, ""))
```

```
# A tibble: 4 Ã— 3
  name  band    plays   
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   
1 Mick  Stones  ""      
2 John  Beatles "guitar"
3 Paul  Beatles "bass"  
4 Keith &lt;NA&gt;    "guitar"
```
]


---

## Replacing `NA` values with something else

Replace `NA`s with empty strings in all columns:

.small-font[

```r
band_data %&gt;%
  mutate(across(everything(), ~replace_na(.x, "")))
```

```
# A tibble: 4 Ã— 3
  name  band      plays   
  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;   
1 Mick  "Stones"  ""      
2 John  "Beatles" "guitar"
3 Paul  "Beatles" "bass"  
4 Keith ""        "guitar"
```
]

---

## Replacing things with `NA` values

Replace empty strings with `NA` in `plays` column (requires **naniar** package):

.small-font[

```r
band_data %&gt;%
  mutate(across(everything(), ~replace_na(.x, ""))) %&gt;%
  replace_with_na_at("plays", ~.x == "")
```

```
# A tibble: 4 Ã— 3
  name  band      plays 
  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; 
1 Mick  "Stones"  &lt;NA&gt;  
2 John  "Beatles" guitar
3 Paul  "Beatles" bass  
4 Keith ""        guitar
```
]

---

## Replacing things with `NA` values

Replace empty strings with `NA` in all columns (requires **naniar** package):

.small-font[

```r
band_data %&gt;%
  mutate(across(everything(), ~replace_na(.x, ""))) %&gt;%
  replace_with_na_all(~.x == "")
```

```
# A tibble: 4 Ã— 3
  name  band    plays 
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
1 Mick  Stones  &lt;NA&gt;  
2 John  Beatles guitar
3 Paul  Beatles bass  
4 Keith &lt;NA&gt;    guitar
```
]

---

## Removing rows with `NA` values

Remove all rows with any `NA`s with `na.omit()`:

.small-font[

```r
band_data %&gt;%
  na.omit()
```

```
# A tibble: 2 Ã— 3
  name  band    plays 
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
1 John  Beatles guitar
2 Paul  Beatles bass  
```
]

---

## Removing rows with `NA` values

Remove all rows where specific columns contain `NA`s:

.small-font[

```r
band_data %&gt;%
  filter(!is.na(plays))
```

```
# A tibble: 3 Ã— 3
  name  band    plays 
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
1 John  Beatles guitar
2 Paul  Beatles bass  
3 Keith &lt;NA&gt;    guitar
```
]

---

## Removing rows with `NA` values

Conversely:

.small-font[

```r
band_data %&gt;%
  filter(is.na(plays))
```

```
# A tibble: 1 Ã— 3
  name  band   plays
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
1 Mick  Stones &lt;NA&gt; 
```
]

---

## Visualizing `NA`s

.small-font.pull-left.width-40[

```r
ggplot(NCbirths) +
  aes(Weeks, Gained) +
  geom_point()
```

By default, missing points are not shown
]

.pull-right.xtiny-font.width-55[

```
Warning: Removed 40 rows containing missing values (`geom_point()`).
```

&lt;img src="know-your-data-2_files/figure-html/NCbirths-plot-missing-out-1.svg" width="75%" /&gt;
]


---

## Visualizing `NA`s

.small-font.pull-left.width-40[

```r
library(naniar)

ggplot(NCbirths) +
  aes(Weeks, Gained) +
  geom_miss_point()
```

Can show them with the **naniar** package
]

.pull-right.xtiny-font.width-55[
&lt;img src="know-your-data-2_files/figure-html/NCbirths-plot-missing2-out-1.svg" width="95%" /&gt;
]

[//]: # "segment ends here"


---

## Further reading

- Gebru et al., "Datasheets for Datasets", [arXiv:1803.09010](https://arxiv.org/abs/1803.09010)
- Data Nutrition Project, https://datanutrition.org/
- **dplyr** reference documentation: [across()](https://dplyr.tidyverse.org/reference/across.html)
- **naniar** documentation: [geom_miss_point()](http://naniar.njtierney.com/reference/geom_miss_point.html)
- **naniar** reference documentation: [replace_with_na_at()](http://naniar.njtierney.com/reference/replace_with_na_at.html)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"slideNumberFormat": ""
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
